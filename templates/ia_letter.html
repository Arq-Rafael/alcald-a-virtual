{% extends "base.html" %}
{% block content %}

<h1 class="mb-3">Redactar Oficio</h1>

<div class="row g-4">
  <div class="col-lg-6">
    <form method="post">
      <div class="card shadow-sm">
        <div class="card-header">Encabezado</div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">N° de oficio</label>
              <input name="numero" class="form-control" value="{{ form_data.numero if form_data else '' }}"
                placeholder="Ej. 2025-1234">
            </div>
            <div class="col-md-4">
              <label class="form-label">Fecha</label>
              <input name="fecha" type="date" class="form-control" value="{{ form_data.fecha if form_data else '' }}">
            </div>
            <div class="col-md-4">
              <label class="form-label">Dependencia emisora</label>
              <input name="dependencia" class="form-control" value="{{ form_data.dependencia if form_data else '' }}"
                placeholder="Secretaría de Planeación">
            </div>
          </div>
        </div>
      </div>

      <div class="card shadow-sm mt-3">
        <div class="card-header">Destinatario</div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Nombre</label>
              <input name="destinatario" class="form-control" value="{{ form_data.destinatario if form_data else '' }}"
                placeholder="Ej. Juan Pérez">
            </div>
            <div class="col-md-6">
              <label class="form-label">Cargo</label>
              <input name="cargo_dest" class="form-control" value="{{ form_data.cargo_dest if form_data else '' }}"
                placeholder="Director(a)">
            </div>
            <div class="col-md-6">
              <label class="form-label">Entidad</label>
              <input name="entidad_dest" class="form-control" value="{{ form_data.entidad_dest if form_data else '' }}"
                placeholder="Alcaldía Municipal">
            </div>
            <div class="col-md-6">
              <label class="form-label">Ciudad</label>
              <input name="ciudad_dest" class="form-control" value="{{ form_data.ciudad_dest if form_data else '' }}"
                placeholder="Supatá (Cundinamarca)">
            </div>
          </div>
        </div>
      </div>

      <div class="card shadow-sm mt-3">
        <div class="card-header">Contenido</div>
        <div class="card-body">
          <div class="mb-3">
            <label class="form-label">Asunto</label>
            <input name="asunto" class="form-control" value="{{ form_data.asunto if form_data else '' }}"
              placeholder="Ej. Solicitud de información">
          </div>
          <div class="mb-3">
            <label class="form-label">Referencia</label>
            <input name="referencia" class="form-control" value="{{ form_data.referencia if form_data else '' }}"
              placeholder="Radicado / Contrato / Norma">
          </div>
          <div class="mb-3">
            <label class="form-label">Cuerpo del oficio</label>
            <textarea name="cuerpo" rows="8" class="form-control"
              placeholder="Escribe el contenido del oficio">{{ form_data.cuerpo if form_data else '' }}</textarea>
          </div>
        </div>
      </div>

      <div class="card shadow-sm mt-3">
        <div class="card-header">Firma y cierres</div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Firmante</label>
              <input name="firmante_nombre" class="form-control"
                value="{{ form_data.firmante_nombre if form_data else '' }}" placeholder="Nombre completo">
            </div>
            <div class="col-md-6">
              <label class="form-label">Cargo firmante</label>
              <input name="firmante_cargo" class="form-control"
                value="{{ form_data.firmante_cargo if form_data else '' }}" placeholder="Secretario(a) de ...">
            </div>
            <div class="col-md-6">
              <label class="form-label">Anexos</label>
              <input name="anexos" class="form-control" value="{{ form_data.anexos if form_data else '' }}"
                placeholder="(si aplica)">
            </div>
            <div class="col-md-6">
              <label class="form-label">Copias (CC)</label>
              <input name="copias" class="form-control" value="{{ form_data.copias if form_data else '' }}"
                placeholder="(si aplica)">
            </div>
          </div>

          <hr class="my-3">
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Elaboró</label>
              <input name="elaboro" class="form-control" value="{{ form_data.elaboro if form_data else '' }}">
            </div>
            <div class="col-md-4">
              <label class="form-label">Revisó</label>
              <input name="reviso" class="form-control" value="{{ form_data.reviso if form_data else '' }}">
            </div>
            <div class="col-md-4">
              <label class="form-label">Teléfono / Email</label>
              <input name="telefono" class="form-control mb-2" value="{{ form_data.telefono if form_data else '' }}"
                placeholder="Tel.">
              <input name="email" class="form-control" value="{{ form_data.email if form_data else '' }}"
                placeholder="correo@...">
            </div>
          </div>
        </div>
      </div>

      <div class="d-flex gap-2 mt-3">
        <button name="action" value="preview" class="btn btn-outline-secondary">Previsualizar</button>
        <button name="action" value="download" class="btn btn-success">Descargar PDF</button>
        <a href="{{ url_for('ia') }}" class="btn btn-link">Volver a IA Municipal</a>
      </div>
    </form>
  </div>


  <div class="col-lg-6">
    {% if preview_html %}
    <div class="card shadow-sm">
      <div class="card-header">Previsualización</div>
      <div class="card-body">
        <iframe style="width:100%; height:80vh; border:1px solid #ddd;" srcdoc="{{ preview_html|e }}"></iframe>
      </div>
    </div>
    {% else %}
    <div class="alert alert-info">Completa el formulario y pulsa <strong>Previsualizar</strong> para ver el oficio aquí.
    </div>
    {% endif %}
  </div>
</div>

{% endblock %}